<%- include('ui/header') %>

    <section id="chat">
        <div id="messages">
            <div class="message received">
                <span class="message-info">System • 11:24 AM</span>
                Welcome to the modern chat template! Feel free to send a message.
            </div>
            <div class="message sent">
                <span class="message-info">You • 11:25 AM</span>
                This interface looks amazing!
            </div>
        </div>
        <form id="form">
            <input id="input" autocomplete="off" placeholder="Type your message..." />
            <button type="submit">
                <span>Send</span>
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
            </button>
        </form>
    </section>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        const form = document.getElementById('form');
        const input = document.getElementById('input');
        const messages = document.getElementById('messages');

        class Chat {
            init() {
                chat.scrollTop();
                form.addEventListener('submit', (e) => chat.emit(e));
                socket.on('chat message', (data) => chat.on(data));
            }

            on(data) {
                const timeStr = this.getDate();
                const isMe = this.isMe(data);
                this.addMessage(data, isMe, timeStr);
                this.scrollBottom();
            }

            emit(e) {
                e.preventDefault();
                if (input.value) {
                    socket.emit('chat message', {
                        text: input.value,
                        id: socket.id
                    });
                    input.value = '';
                }
            }

            getDate() {
                const now = new Date();
                const timeStr = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                return timeStr;
            }

            addMessage(data, isMe, timeStr) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isMe ? 'sent' : 'received'}`;

                messageDiv.innerHTML = `
                <span class="message-info">${isMe ? 'You' : 'Stranger'} • ${timeStr}</span>
                ${data.text}
            `;

                messages.appendChild(messageDiv);
            }

            isMe(data) {
                return data.id === socket.id;
            }

            scrollBottom() {
                messages.scrollTop = messages.scrollHeight;
            }

            scrollTop() {
                messages.scrollTop = messages.scrollHeight;
            }
        }

        const chat = new Chat();
        chat.init();
    </script>

    <%- include('ui/footer') %>